# ν¬νΈν¬μ›λ”©

### ν¬νΈν¬μ›λ”©

μ „λ‹¬ λ°›μ€ ν¨ν‚·μ— IP:Port μ μ •λ³΄λ¥Ό μμ‹ μ ν¬νΈ ν¬μ›λ”© μ„¤μ • μ •λ³΄λ¥Ό μ°Έκ³ ν•μ—¬ νΉμ • IP:Port λ΅ λ³€ν™μ‹μΌμ£Όλ” κΈ°λ¥
![image](https://github.com/sujinsu/TIL/assets/87465326/645b5935-1138-4000-a324-e9ed1eb75ae6)





## window

- ν¬νΈν¬μ›λ”© μ„¤μ •

  - 10.10.10.100:800  μΌλ΅ μ „λ‹¬λ°›μ€ ν¨ν‚·μ„ 192.168.100.31.:8080 μΌλ΅ ν¬μ›λ”© ν•΄μ¤λ‹λ‹¤.

  ```python
  # netsh interface portproxy add v4tov4 listenport=[μ „λ‹¬ λ°›μ€ Port] listenaddress=[μ „λ‹¬ λ°›μ€ IP] connectport=[λ³€ν™ν•  Port] connectaddress=[λ³€ν™ν•  IP]
  netsh interface portproxy add v4tov4 listenport=800 listenaddress=10.10.10.100 connectport=8080 connectaddress=192.168.100.31
  ```

- ν¬νΈν¬μ›λ”© ν•΄μ 

  - 10.10.10.100:800 μ— λ€ν• μ„¤μ • ν•΄μ 

  ```python
  # netsh interface portproxy delete v4tov4 listenport=[μ „λ‹¬λ°›μ€ Port] listenaddress=[μ „λ‹¬λ°›μ€ IP]
  netsh interface portproxy delete v4tov4 listenport=800 listenaddress=10.10.10.100
  ```

- ν¬νΈν¬μ›λ”© ν™•μΈ

  - ν¬νΈν¬μ›λ”©μΌλ΅ μ„¤μ •λ μ „μ²΄ λ©λ΅ μ΅°ν

  ```python
  netsh interface portproxy show v4tov4
  ```

## μ°λ¶„ν¬

- ν¬νΈ ν¬μ›λ”© μ„¤μ •
  - 80 β†’ 5000 λ΅ ν¬νΈ ν¬μ›λ”©

```python
$ sudo iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 -j REDIRECT --to-port 5000
```

- ν¬νΈ ν¬μ›λ”© μ΅°ν

```python
$ sudo iptables -t nat -L --line-numbers
```

- ν¬νΈ ν¬μ›λ”© μ‚­μ 
  - μ„ μ΅°νμ—μ„ 5λ²μ— ν•΄λ‹Ήν•λ” ν¬νΈ ν¬μ›λ”© μ‚­μ 

```python
$ sudo iptables -t nat -D PREROUTING 5
```

- μ „μ²΄ ν¬νΈ ν™•μΈ

```python
$ netstat -nap
```

- λ€κΈ° μ¤‘ ν¬νΈ ν™•μΈ

```python
$ netstat -nap|grep LISTEN
```

- λ¦¬λ…μ¤ ν¬νΈ μ‚¬μ©μ—¬λ¶€ ν™•μΈ

```python
$ sudo netstat -ntlp|grep :80
```





## Docker

- λ„μ»¤ μ»¨ν…μ΄λ„ μ‹¤ν–‰ μ‹ κΈ°λ³Έμ μΌλ΅ `NAT`(Network Address Translation) ν™κ²½ μ μ© λ„¤νΈμ›ν‚Ήμ„ μ„ν•΄ NAT λ‚΄λ¶€ λ§ IP μ£Όμ†λ¥Ό ν• λ‹Ή
  - λ„μ»¤ μ»¨ν…μ΄λ„λ” λ„¤νΈμ›ν¬ κµ¬μ„± μƒ NAT λ‚΄λ¶€λ§μ—μ„ λ™μ‘, κ³µμΈ IP μ£Όμ†κ°€ μ•„λ‹ μ‚¬μ„¤ IP μ£Όμ† μ‚¬μ© β†’ κΈ°λ³Έμ μΌλ΅ μ»¨ν…μ΄λ„ μ™Έλ¶€(ex μΈν„°λ„·λ§)μ—μ„ λ‚΄λ¶€λ΅μ μ ‘μ†μ΄ λ¶κ°€λ¥
  - μ΄λ¥Ό κ·Ήλ³µν•κΈ° μ„ν•΄ NAT ν™κ²½μ—μ„ ν¬νΈ ν¬μ›λ”©(ν¬νΈ λ§µν•‘) μ΄λΌλ” κΈ°λ²• λ„λ¦¬ μ‚¬μ© β†’ NAT λ™μ‘ν•λ” λΌμ°ν„°/κ²μ΄νΈμ›¨μ΄μ νΉμ • ν¬νΈλ²νΈλ΅ μ μ…λλ” νΈλν”½μ„ NAT λ‚΄λ¶€μ—μ„ λ™μ‘ν•λ” μ‹μ¤ν…μ νΉμ • ν¬νΈλ΅ μ „λ‹¬
- ifconfig
  - eth0
    - λ„¤νΈμ›ν¬ μΈν„°νμ΄μ¤μ— NAT λ‚΄λ¶€λ§ IP μ£Όμ† ν• λ‹Ή
  - lo
    - λ΅μ»¬ νΈμ¤νΈ
- route
  - λ””ν΄νΈ κ²μ΄νΈμ›¨μ΄ ip μ£Όμ† ν™•μΈ β† λ„μ»¤ μ»¨ν…μ΄λ„ λ™μ‘ μ¤‘μΈ νΈμ¤νΈ μ‹μ¤ν…

π‘‰ λ„μ»¤ μ»¨ν…μ΄λ„ λ‚΄λ¶€μ—μ„λ” ν•΄λ‹Ή λ””ν΄νΈ κ²μ΄νΈμ›¨μ΄λ¥Ό ν†µν•΄ μ»¨ν…μ΄λ„ μ™Έλ¶€μ™€μ ν†µμ‹  κ°€λ¥

- ν¬νΈ ν¬μ›λ”© μ„¤μ •

  - <host port number> : νΈμ¤νΈ μ‹μ¤ν…μ—μ„ μ‚¬μ©λλ” ν¬νΈ λ²νΈ

  - <container port number> : μ»¨ν…μ΄λ„ λ‚΄μ—μ„ μ‚¬μ©λλ” ν¬νΈ λ²νΈ

  - protocol : ν”„λ΅ν† μ½ μ ν• - udp, tcp, stcp λ“±

  - ex) -p 8080:80/tcp

    - νΈμ¤νΈ μ‹μ¤ν…μ 8080 tcp ν¬νΈλ΅ μ μ…λλ” νΈλν©μ€ λ¨λ‘ λ„μ»¤ μ»¨ν…μ΄λ„μ 80λ² tcpν¬νΈλ΅ μ „λ‹¬

    - ```
      $ docker run -p <host port number>:<container port number>/<protocol> [IMAGE NAME] [OTHER OPTioONS...]
      ```

      

β€‹	

